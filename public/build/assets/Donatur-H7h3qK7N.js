import{r as l,j as e,H as f}from"./app-C8lhSVMT.js";import{A as y}from"./AdminLayout-DayVYhfC.js";import{S as N}from"./search-B5pCdbKa.js";import{D as b}from"./download-C3i-z5bE.js";import{M as w}from"./mail-KN8d_enA.js";import{P as v}from"./phone-D2QptTw1.js";import"./createLucideIcon-CskaXQlG.js";import"./file-text-5M3K4KXe.js";import"./users-BEapWFTP.js";import"./menu-wL7uFBCp.js";function M(){const[c,d]=l.useState([]),[u,o]=l.useState(!0),[x,m]=l.useState(null),[p,g]=l.useState("");l.useEffect(()=>{const a=route("admin.donations.export")+"?status=paid";fetch(a,{credentials:"same-origin"}).then(s=>{if(!s.ok)throw new Error("Gagal mengambil data donasi (CSV)");return s.text()}).then(s=>{try{const i=s.trim().split(`
`);if(i.length<=1){d([]),o(!1);return}const j=i.slice(1).map(n=>{const t=n.split(",");return{invoice:t[0]??"",name:(t[1]??"").trim(),email:(t[2]??"").trim(),phone:(t[3]??"").trim(),nominal:Number((t[4]??"0").replace(/[^0-9\-]/g,""))||0,status:(t[5]??"").trim(),tanggal_raw:(t[6]??"").trim()}}).reduce((n,t)=>{const r=`${t.name}|${t.email}|${t.phone}`;return n[r]||(n[r]={id:Object.keys(n).length+1,name:t.name||"-",email:t.email||"-",phone:t.phone||"-",total_donasi:0,last_donation:t.tanggal_raw||"-"}),n[r].total_donasi+=t.nominal||0,t.tanggal_raw&&t.tanggal_raw>(n[r].last_donation||"")&&(n[r].last_donation=t.tanggal_raw),n},{});d(Object.values(j))}catch(i){m(String(i))}finally{o(!1)}}).catch(s=>{m(s.message||String(s)),o(!1)})},[]);const h=(()=>{const a=p.toLowerCase().trim();return a?c.filter(s=>(s.name||"").toLowerCase().includes(a)||(s.email||"").toLowerCase().includes(a)||(s.phone||"").toLowerCase().includes(a)):c})();return e.jsxs(y,{children:[e.jsx(f,{title:"Database Donatur"}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-lg font-bold",children:"Database Donatur"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(N,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:16}),e.jsx("input",{value:p,onChange:a=>g(a.target.value),placeholder:"Cari nama, email, atau telepon",className:"pl-9 pr-3 py-2 border rounded"})]}),e.jsxs("a",{href:route("admin.donations.export")+"?status=paid",className:"flex items-center gap-2 text-sm text-blue-600",children:[e.jsx(b,{size:16})," Ekspor CSV"]})]})]}),e.jsx("div",{className:"overflow-x-auto bg-white border rounded",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-6 py-3",children:"Nama"}),e.jsx("th",{className:"text-left px-6 py-3",children:"Kontak"}),e.jsx("th",{className:"text-left px-6 py-3",children:"Total Donasi"}),e.jsx("th",{className:"text-left px-6 py-3",children:"Terakhir Donasi"}),e.jsx("th",{className:"text-center px-6 py-3",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:x?e.jsx("tr",{children:e.jsxs("td",{colSpan:5,className:"px-6 py-6 text-center text-red-600",children:["Gagal memuat data donatur: ",x]})}):u?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-6 text-center text-gray-500",children:"Memuat data donaturâ€¦"})}):h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-6 text-center text-gray-500",children:"Tidak ada hasil."})}):h.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 transition",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"font-bold text-gray-800",children:a.name})}),e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col gap-1 text-xs",children:[a.email&&a.email!=="-"&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(w,{size:12,className:"text-gray-400"})," ",a.email]}),a.phone&&a.phone!=="-"&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(v,{size:12,className:"text-gray-400"})," ",a.phone]}),(!a.email||a.email==="-")&&(!a.phone||a.phone==="-")&&e.jsx("span",{className:"text-gray-400 italic",children:"Tidak ada data"})]})}),e.jsx("td",{className:"px-6 py-4 font-semibold text-green-600",children:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a.total_donasi||0)}),e.jsx("td",{className:"px-6 py-4 text-gray-500",children:a.last_donation}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx("button",{className:"text-blue-600 hover:underline text-xs font-bold bg-blue-50 px-3 py-1 rounded",children:"Lihat Riwayat"})})]},a.id))})]})})]})]})}export{M as default};
